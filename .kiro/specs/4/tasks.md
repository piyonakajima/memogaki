# Implementation Plan

## 読み返しモード（review-mode）実装タスク

- [ ] 1. 型定義とコンポーネント基盤の構築
- [ ] 1.1 読み返しモードの型定義を作成する
  - コンポーネントが受け取るプロパティの型を定義する（テキスト、ラウンド情報、コールバック等）
  - writing-modeと同様に `onComplete?: (text: string) => void` 形式でコールバックを定義する
  - デフォルト値を `export const` でエクスポートする（writing-modeと同じパターン）
  - _Requirements: 6.1, 6.2, 6.3_

- [ ] 1.2 読み返しモードコンポーネントの骨格を作成する
  - コンポーネントファイルとエクスポート用インデックスファイルを作成する
  - プロパティを受け取り、基本的なJSX構造を返すコンポーネントを実装する
  - 追記テキストのローカル状態管理を設定する
  - 各要素に `data-testid` 属性を設定する（writing-modeと同じパターン）
  - _Requirements: 6.1, 6.2, 6.5_

- [ ] 2. テキスト表示機能の実装
- [ ] 2.1 書き出し内容の表示エリアを実装する
  - 親コンポーネントから渡されたテキストを表示する
  - 改行を保持した状態でテキストを表示する（`white-space: pre-wrap`）
  - テキストが空の場合はプレースホルダーメッセージを表示する
  - ダークテーマに合わせた色設定（`rgba(255, 255, 255, 0.87)`）
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 3. 追記機能の実装
- [ ] 3.1 追記入力エリアを実装する
  - テキスト入力エリアを配置し、ユーザーが追記を入力できるようにする
  - 入力内容をリアルタイムでローカル状態に反映する
  - 未入力時にプレースホルダーを表示する
  - writing-modeと同じスタイルパターン（背景、ボーダー、フォーカス）を適用する
  - _Requirements: 2.1, 2.2, 2.3_

- [ ] 3.2 テキスト統合ロジックを実装する
  - 元のテキストと追記テキストを区切り線で統合する関数を作成する
  - 追記が空の場合は元のテキストのみを返す
  - 統合済みテキストをコールバックに渡す（writing-modeと同じパターン）
  - _Requirements: 2.4, 2.5_

- [ ] 4. 進行状況表示の実装
- [ ] 4.1 ラウンド進行状況インジケーターを実装する
  - 現在のラウンド番号と総ラウンド数を「X / Y」形式で表示する
  - 画面上部の視認しやすい位置に配置する
  - プロパティ変更時に表示を更新する
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 5. 完了ボタンと遷移機能の実装
- [ ] 5.1 「次へ」ボタンを実装する
  - タップしやすいサイズ（最小44px）のボタンを配置する
  - クリック時に統合済みテキストを親コンポーネントに通知する（onCompleteコールバック）
  - writing-modeと同様にオプショナルチェイニングで安全に呼び出す
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 6.3_

- [ ] 5.2 最終ラウンドでのボタン表示切り替えを実装する
  - 最終ラウンドフラグに応じてボタンラベルを「次へ」から「完了」に変更する
  - ボタンのスタイルも最終ラウンド用に切り替える（青→緑）
  - _Requirements: 3.5, 6.4_

- [ ] 6. レスポンシブデザインの実装
- [ ] 6.1 モバイルファーストのスタイルを実装する
  - モバイル画面（768px未満）で全幅レイアウトを適用する
  - 適切なパディングとマージンを設定する
  - タップ操作に適したUI要素サイズを確保する
  - ダークテーマカラーを適用する（writing-modeと統一）
  - _Requirements: 5.1, 5.2, 5.3_

- [ ] 6.2 デスクトップ向けスタイルを実装する
  - 768px以上の画面幅で最大幅640pxを設定し中央揃えにする
  - テキスト表示エリアと追記エリアの高さを調整する
  - _Requirements: 5.4_

- [ ] 6.3 ソフトキーボード対応のレイアウト調整を実装する
  - モバイルでソフトキーボード表示時に追記エリアが隠れないよう配置を調整する
  - _Requirements: 5.5_

- [ ] 7. アクセシビリティ対応の実装
- [ ] 7.1 ARIA属性を設定する
  - テキスト表示エリアにaria-labelを設定する
  - 追記入力エリアにaria-labelを設定する
  - 進行状況表示にaria-live属性を設定しスクリーンリーダーに通知する
  - `__sr-only` クラスを追加する（writing-modeと同じパターン）
  - _Requirements: 7.1, 7.2_

- [ ] 7.2 キーボード操作とフォーカス管理を実装する
  - Tab順序を適切に設定する
  - ボタンのEnterキー操作を確保する
  - フォーカス時のアウトライン表示を実装する（`outline: 2px solid #4a90d9`）
  - ハイコントラストモード対応のスタイルを追加する
  - _Requirements: 7.3, 7.4, 7.5_

- [ ] 8. テストの実装
- [ ] 8.1 コンポーネントの単体テストを作成する
  - テキストが正しく表示されることをテストする
  - 空テキスト時のプレースホルダー表示をテストする
  - 追記入力が動作することをテストする
  - 進行状況が正しく表示されることをテストする
  - 「次へ」ボタンクリックでonCompleteが呼ばれることをテストする
  - `data-testid` を使用してテスト対象を特定する
  - _Requirements: 1.1-1.5, 2.1-2.5, 3.1-3.5, 4.1-4.5_

- [ ] 8.2 データ統合ロジックのテストを作成する
  - 追記ありの場合の統合結果をテストする
  - 追記なしの場合の統合結果をテストする
  - onCompleteに渡される統合済みテキストをテストする
  - 最終ラウンド時のボタン表示をテストする
  - _Requirements: 2.4, 2.5, 3.5, 6.3, 6.4_

- [ ] 8.3 アクセシビリティテストを作成する
  - ARIA属性の設定をテストする
  - キーボードナビゲーションをテストする
  - _Requirements: 7.1-7.5_

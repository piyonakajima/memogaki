# Implementation Plan

## Google AdSense統合 (adsense-integration)

---

- [x] 1. 基盤セットアップ: 設定管理と型定義
- [x] 1.1 AdSense設定の一元管理機能を実装する
  - パブリッシャーID、スロットID、有効化フラグ、テストモードフラグを管理する設定を作成する
  - 環境変数から設定値を読み込み、デフォルト値にフォールバックする仕組みを実装する
  - 開発環境では広告を無効化できるオプションを提供する
  - 設定が一箇所で管理され、変更が容易な構造にする
  - _Requirements: FR-1.2, FR-2.3, NFR-5.1, NFR-5.3_

- [x] 1.2 AdSense関連の型定義を作成する
  - 広告バナーコンポーネントのプロパティ型を定義する
  - 広告読み込み状態（読み込み中、完了、エラー、ブロック）を表す型を定義する
  - フッターコンポーネントのプロパティ型を定義する
  - JSDocコメントで各型の用途を明確にする
  - _Requirements: TC-2（TypeScript準拠）_

- [x] 1.3 環境変数のサンプルファイルを作成する
  - AdSense設定に必要な環境変数の一覧を文書化する
  - 開発・ステージング・本番環境での設定例を記載する
  - Vite環境変数の型定義を追加する
  - _Requirements: FR-1.2, NFR-5.1_

---

- [x] 2. 広告バナーコンポーネントの実装
- [x] 2.1 広告バナー表示機能を実装する
  - AdSense広告ユニットを表示するコンポーネントを作成する
  - レスポンシブ形式の水平バナー広告を表示する
  - 設定からパブリッシャーIDとスロットIDを取得して適用する
  - テストモード時はテスト広告属性を付与する
  - _Requirements: FR-2.1, FR-2.2, FR-2.3, TC-3_

- [x] 2.2 広告ブロッカー検出と graceful degradation を実装する
  - 広告が無効または設定が不足している場合は何も表示しない
  - 広告の読み込みをタイムアウトで監視し、ブロッカーを検出する
  - エラーまたはブロック時は空白を残さずコンポーネントを非表示にする
  - 重複初期化を防ぐ仕組みを実装する
  - _Requirements: FR-2.5, NFR-5.2_

- [x] 2.3 広告バナーのスタイルを実装する
  - レイアウトシフト防止のため最小高さを設定する
  - モバイル・デスクトップで適切なサイズになるレスポンシブスタイルを実装する
  - 既存のノート風テーマと調和するデザインにする
  - _Requirements: FR-2.4, NFR-1.2, NFR-2.1, NFR-2.2, NFR-2.3, NFR-6.1, NFR-6.3_

---

- [x] 3. フッターコンポーネントの実装
- [x] 3.1 フッター本体の機能を実装する
  - 画面下部に固定表示されるフッターを作成する
  - 広告表示領域とリンク領域を含む構造にする
  - 広告の表示/非表示を制御できるプロパティを提供する
  - 設定に基づいて広告の表示可否を判断する
  - _Requirements: FR-4.1, FR-4.2, FR-4.3, NFR-5.2_

- [x] 3.2 プライバシーポリシーリンクを実装する
  - フッター内に「プライバシーポリシー」リンクを配置する
  - リンククリック時にコールバック関数を呼び出す
  - 目立ちすぎない控えめなスタイルを適用する
  - キーボードアクセシビリティ（フォーカス表示）を確保する
  - _Requirements: FR-3.2, NFR-4.2, NFR-6.2_

- [x] 3.3 フッターのスタイルを実装する
  - 画面下部に固定位置（position: fixed）で表示する
  - 最大高さ80pxの制限を設け、コンテンツ領域を確保する
  - 既存のカラーパレット（ノート風テーマ）と調和させる
  - 広告とリンクを視覚的に区別するボーダーを設ける
  - _Requirements: FR-4.3, NFR-3.3, NFR-4.2, NFR-6.1, NFR-6.3_

---

- [x] 4. プライバシーポリシーページの実装
- [x] 4.1 プライバシーポリシーコンテンツを実装する
  - 広告（Google AdSense）に関する説明セクションを作成する
  - Cookie使用に関する説明を記載する
  - 第三者への情報提供に関する説明を含める
  - お問い合わせ方法を案内する
  - 日本語で読みやすい文章を作成する
  - _Requirements: FR-3.4, NFR-4.3, NFR-4.4_

- [x] 4.2 プライバシーポリシーページのナビゲーションを実装する
  - 「戻る」ボタンでメインアプリに戻れるようにする
  - ページヘッダーにタイトルと戻るボタンを配置する
  - 戻るボタンのクリックでコールバックを呼び出す
  - _Requirements: FR-3.1, FR-3.3_

- [x] 4.3 プライバシーポリシーページのスタイルを実装する
  - 読みやすいレイアウト（見出し、段落、リンク）を設計する
  - 既存テーマと一貫したデザインを適用する
  - モバイルでも読みやすいレスポンシブ対応を行う
  - 最終更新日を目立たない位置に表示する
  - _Requirements: NFR-6.1_

---

- [x] 5. アプリケーション統合
- [x] 5.1 ルーティング機能を追加する
  - メインアプリとプライバシーポリシーページを切り替える状態管理を追加する
  - プライバシーリンククリックでポリシーページに遷移する
  - 戻るボタンでメインアプリに戻る
  - GitHub Pages（SPA）で動作する形式を維持する
  - _Requirements: FR-3.1, FR-3.3, TC-1_

- [x] 5.2 レイアウト調整を実装する
  - メインコンテンツがフッターに隠れないようパディングを追加する
  - 書き出しモード・読み返しモードでテキストエリアが見切れないことを確認する
  - フッター高さに応じた動的なスペース確保を実装する
  - _Requirements: FR-4.4, NFR-3.1, NFR-3.2_

- [x] 5.3 AdSenseスクリプトをHTMLに追加する
  - index.htmlのheadセクションにAdSenseスクリプトを追加する
  - 非同期読み込み（async属性）を使用してページ読み込みをブロックしない
  - パブリッシャーIDのプレースホルダーを配置する（本番時に置換）
  - _Requirements: FR-1.1, FR-1.3, NFR-1.1_

---

- [x] 6. テストの実装
- [x] 6.1 広告バナーコンポーネントのテストを作成する
  - 設定が無効な場合にnullを返すことを検証する
  - パブリッシャーIDが未設定の場合の動作を検証する
  - DOM要素に正しい属性が設定されることを検証する
  - _Requirements: FR-2.5, NFR-5.3_

- [x] 6.2 フッターコンポーネントのテストを作成する
  - プライバシーリンクのクリックでコールバックが呼ばれることを検証する
  - showAdプロパティによる広告表示/非表示を検証する
  - フッターが正しくレンダリングされることを検証する
  - _Requirements: FR-3.2, FR-4.2_

- [x] 6.3 プライバシーポリシーページのテストを作成する
  - 戻るボタンのクリックでコールバックが呼ばれることを検証する
  - 必須コンテンツ（広告、Cookie、問い合わせ）が表示されることを検証する
  - 各セクションのヘッダーが存在することを検証する
  - _Requirements: FR-3.4_

- [x] 6.4 統合テストを実装する
  - App.tsxでのルーティング遷移（メイン↔プライバシー）を検証する
  - フッターからのプライバシーページ遷移を検証する
  - プライバシーページからの戻り動作を検証する
  - _Requirements: FR-3.1, FR-3.3_

---

## 要件カバレッジ確認

| 要件ID | タスク |
|--------|--------|
| FR-1.1 | 5.3 |
| FR-1.2 | 1.1, 1.3 |
| FR-1.3 | 5.3 |
| FR-2.1 | 2.1 |
| FR-2.2 | 2.1 |
| FR-2.3 | 1.1, 2.1 |
| FR-2.4 | 2.3 |
| FR-2.5 | 2.2, 6.1 |
| FR-3.1 | 4.2, 5.1 |
| FR-3.2 | 3.2, 6.2 |
| FR-3.3 | 4.2, 5.1 |
| FR-3.4 | 4.1, 6.3 |
| FR-4.1 | 3.1 |
| FR-4.2 | 3.1, 6.2 |
| FR-4.3 | 3.1, 3.3 |
| FR-4.4 | 5.2 |
| NFR-1.1 | 5.3 |
| NFR-1.2 | 2.3 |
| NFR-2.1〜2.3 | 2.3 |
| NFR-3.1〜3.3 | 3.3, 5.2 |
| NFR-4.2〜4.4 | 3.2, 3.3, 4.1 |
| NFR-5.1〜5.3 | 1.1, 2.2, 3.1, 6.1 |
| NFR-6.1〜6.3 | 2.3, 3.2, 3.3, 4.3 |
| TC-1 | 5.1 |
| TC-2 | 1.2 |
| TC-3 | 2.1 |

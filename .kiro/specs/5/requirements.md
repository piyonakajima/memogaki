# Requirements Document

## Introduction

「瞬発思考」アプリのセッション管理機能。書き出しモードと読み返しモードを統合し、繰り返し回数に基づいたセッションフローを制御する。ユーザーが設定した回数（デフォルト10回）だけ「書き出し→読み返し」のサイクルを繰り返し、セッション全体の進行状態を管理する。セッション完了時には結果出力画面への遷移をトリガーする、アプリの中核となるフロー制御機能。

## Requirements

### Requirement 1: 繰り返し回数の設定

**Objective:** ユーザーとして、セッションの繰り返し回数を設定したい。これにより、自分のペースや目的に合わせた瞬発思考の練習ができる。

#### Acceptance Criteria

1. WHEN セッションが開始される前 THEN セッションマネージャー SHALL 繰り返し回数を設定できるUIを表示する
2. IF 繰り返し回数が指定されない THEN セッションマネージャー SHALL デフォルト値として10回を使用する
3. WHEN ユーザーが回数を変更する THEN セッションマネージャー SHALL 1回から99回の範囲で設定を受け付ける
4. WHEN 繰り返し回数が設定される THEN セッションマネージャー SHALL 設定値を保持し、セッション全体で使用する
5. IF セッションが進行中 THEN セッションマネージャー SHALL 繰り返し回数の変更を許可しない

### Requirement 2: 書き出し→読み返しのモード切替

**Objective:** システムとして、書き出しモードと読み返しモードを自動的に切り替えたい。これにより、ユーザーがスムーズにセッションを進行できる。

#### Acceptance Criteria

1. WHEN セッションが開始される THEN セッションマネージャー SHALL 書き出しモードを最初に表示する
2. WHEN 書き出しモードのタイマーが終了する THEN セッションマネージャー SHALL 読み返しモードに切り替える
3. WHEN 読み返しモードで「次へ」ボタンが押される AND 次のラウンドがある THEN セッションマネージャー SHALL 書き出しモードに切り替える
4. WHEN モードが切り替わる THEN セッションマネージャー SHALL 現在のモードを明確に表示する
5. WHILE セッションが進行中 THE セッションマネージャー SHALL 書き出し→読み返しのサイクルを維持する

### Requirement 3: セッション進行状態の管理

**Objective:** システムとして、セッションの進行状態を正確に管理したい。これにより、ユーザーに進行状況を提供し、データの整合性を保てる。

#### Acceptance Criteria

1. WHEN セッションが開始される THEN セッションマネージャー SHALL 現在のラウンドを1に設定する
2. WHEN ラウンドが完了する（読み返しモードで「次へ」が押される） THEN セッションマネージャー SHALL 現在のラウンド番号をインクリメントする
3. WHILE セッションが進行中 THE セッションマネージャー SHALL 現在のラウンド番号と総ラウンド数を保持する
4. WHEN 書き出しモードが完了する THEN セッションマネージャー SHALL 入力されたテキストをそのラウンドのメモとして保存する
5. WHEN 読み返しモードで追記が行われる THEN セッションマネージャー SHALL 追記内容を元のメモに統合して保存する
6. WHILE セッションが進行中 THE セッションマネージャー SHALL 全ラウンドのメモを配列として保持する

### Requirement 4: セッション完了判定

**Objective:** システムとして、セッションの完了を正確に判定したい。これにより、適切なタイミングで結果出力画面へ遷移できる。

#### Acceptance Criteria

1. WHEN 最終ラウンドの読み返しモードで「完了」ボタンが押される THEN セッションマネージャー SHALL セッションを完了状態にする
2. WHEN セッションが完了する THEN セッションマネージャー SHALL onSessionComplete コールバックを呼び出す
3. WHEN セッションが完了する THEN セッションマネージャー SHALL 全ラウンドのメモデータをコールバックに渡す
4. IF 現在のラウンドが総ラウンド数と等しい THEN セッションマネージャー SHALL isLastRound フラグを true に設定する
5. WHEN セッションが完了状態になる THEN セッションマネージャー SHALL それ以上のモード切替を停止する

### Requirement 5: セッション開始・リセット

**Objective:** ユーザーとして、セッションを開始・リセットしたい。これにより、新しいセッションを始めたり、やり直したりできる。

#### Acceptance Criteria

1. WHEN ユーザーがセッション開始ボタンを押す THEN セッションマネージャー SHALL 新しいセッションを開始する
2. WHEN 新しいセッションが開始される THEN セッションマネージャー SHALL 全ての状態を初期化する（ラウンド1、空のメモ配列）
3. IF セッション中にリセットが要求される THEN セッションマネージャー SHALL 確認ダイアログを表示する
4. WHEN リセットが確認される THEN セッションマネージャー SHALL セッションを初期状態に戻す
5. WHEN セッションが初期化される THEN セッションマネージャー SHALL 設定画面（繰り返し回数設定）を表示する

### Requirement 6: セッション状態の提供

**Objective:** 子コンポーネントとして、セッション状態を受け取りたい。これにより、書き出しモードと読み返しモードが適切に動作できる。

#### Acceptance Criteria

1. WHEN 書き出しモードがレンダリングされる THEN セッションマネージャー SHALL onComplete コールバックを書き出しコンポーネントに渡す
2. WHEN 読み返しモードがレンダリングされる THEN セッションマネージャー SHALL currentRound、totalRounds、text プロパティを読み返しコンポーネントに渡す
3. WHEN 読み返しモードがレンダリングされる THEN セッションマネージャー SHALL onNext コールバックを読み返しコンポーネントに渡す
4. IF 最終ラウンド THEN セッションマネージャー SHALL isLastRound プロパティを true として読み返しコンポーネントに渡す
5. WHILE セッションが進行中 THE セッションマネージャー SHALL 子コンポーネントに最新の状態を提供し続ける

### Requirement 7: セッション中断・再開

**Objective:** ユーザーとして、セッションを中断して後で再開したい。これにより、まとまった時間が取れない場合でも瞬発思考を実践できる。

#### Acceptance Criteria

1. WHEN ユーザーがセッション中に離脱する THEN セッションマネージャー SHALL 現在の進行状態を一時保存する
2. WHEN アプリが再度開かれる AND 中断されたセッションがある THEN セッションマネージャー SHALL 再開を促すダイアログを表示する
3. WHEN ユーザーが「再開」を選択する THEN セッションマネージャー SHALL 中断時の状態からセッションを再開する
4. WHEN ユーザーが「新規開始」を選択する THEN セッションマネージャー SHALL 中断されたセッションを破棄し、新しいセッションを開始する
5. IF 中断時に書き出しモードだった THEN セッションマネージャー SHALL そのラウンドの書き出しを最初からやり直す

### Requirement 8: アクセシビリティ対応

**Objective:** すべてのユーザーとして、アクセシブルなセッション体験をしたい。これにより、多様なユーザーが瞬発思考を実践できる。

#### Acceptance Criteria

1. WHEN モードが切り替わる THEN セッションマネージャー SHALL スクリーンリーダー向けにモード変更を通知する（aria-live）
2. WHEN セッションの進行状況が変わる THEN セッションマネージャー SHALL スクリーンリーダー向けに進行状況を通知する
3. WHILE セッションが進行中 THE セッションマネージャー SHALL キーボードナビゲーションを完全にサポートする
4. WHEN セッションが完了する THEN セッションマネージャー SHALL スクリーンリーダー向けに完了を通知する
5. IF 確認ダイアログが表示される THEN セッションマネージャー SHALL フォーカストラップを適用する
